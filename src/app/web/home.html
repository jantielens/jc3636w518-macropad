<!DOCTYPE html>
<html lang="en">
{{HEADER}}
<body>
    <div class="container">
        {{NAV}}

        <form id="config-form">
            <!-- Macros Editor -->
            <section class="section" id="macros-section">
                <h2>‚å®Ô∏è Macros</h2>
                <p style="margin: 0 0 14px 0; color: #57575c;">
                    Configure macro screens √ó 9 buttons. Actions: <strong>Send Keys</strong>, <strong>Previous</strong>, <strong>Next</strong>, or <strong>None</strong>.
                </p>

                <div class="macro-editor">
                    <div class="macro-editor-left">
                        <div class="form-group">
                            <label for="macro_screen_select">Screen</label>
                            <select id="macro_screen_select" name="macro_screen_select"></select>
                            <small>Select which macro screen you‚Äôre editing.</small>
                        </div>

                        <div class="form-group">
                            <label>Buttons</label>
                            <div class="macro-button-grid" id="macro_button_grid"></div>
                            <small>Tap a button slot to edit it. Center is #9.</small>
                        </div>

                        <div class="button-group" style="margin-top: 14px;">
                            <button type="button" class="btn btn-secondary" id="macros_reload_btn">Reload</button>
                        </div>
                        <small style="display:block; margin-top: 10px; color: #6b7280;">
                            Macro changes are saved using the page footer buttons.
                        </small>
                        <div id="macros_dirty_hint" style="display:none; margin-top: 10px; color: #b45309; font-weight: 600;">
                            Unsaved macro changes
                        </div>
                    </div>

                    <div class="macro-editor-right">
                        <div class="form-group">
                            <label for="macro_button_select">Button</label>
                            <select id="macro_button_select" name="macro_button_select"></select>
                            <small>Outer buttons are #1‚Äì#8, center is #9.</small>
                        </div>

                        <div class="form-group">
                            <label for="macro_label">Label</label>
                            <input type="text" id="macro_label" name="macro_label" maxlength="15" placeholder="e.g., Mute">
                            <small>Max 15 characters.</small>
                        </div>

                        <div class="form-group">
                            <label for="macro_action">Action</label>
                            <select id="macro_action" name="macro_action">
                                <option value="none">None (hidden)</option>
                                <option value="send_keys">Send Keys</option>
                                <option value="nav_prev">Previous Screen</option>
                                <option value="nav_next">Next Screen</option>
                            </select>
                            <small>Navigation wraps (Screen 1 ‚Üî Screen 8).</small>
                        </div>

                        <div class="form-group">
                            <label for="macro_script">Script</label>
                            <textarea id="macro_script" name="macro_script" rows="7" maxlength="255" placeholder="Example:\nSTRING Hello world\n"></textarea>
                            <small>Stored now; executed on-device later (DuckyScript-like subset). Max 255 chars.</small>
                        </div>

                        <div class="form-group">
                            <label for="macro_icon_id">Icon ID (reserved)</label>
                            <input type="text" id="macro_icon_id" name="macro_icon_id" maxlength="31" placeholder="e.g., mic_off">
                            <small>Icons are post-MVP. You can pre-fill stable IDs now.</small>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Display Settings Section (hidden if no backlight support) -->
            <section class="section" id="display-settings-section" style="display:none;">
                <h2>üñ•Ô∏è Display Settings</h2>
                <div class="form-group">
                    <label for="backlight_brightness">
                        Backlight Brightness: <span id="brightness-value">100</span>%
                    </label>
                    <input type="range" id="backlight_brightness" name="backlight_brightness" 
                           min="0" max="100" value="100" 
                           style="width: 100%; height: 8px; border-radius: 4px; background: linear-gradient(to right, #007aff 0%, #007aff 100%, #e5e5e5 100%, #e5e5e5 100%);">
                    <small>Brightness adjusts immediately. Click Save to persist across reboots.</small>
                </div>

                <hr style="border: none; border-top: 1px solid #e5e5ea; margin: 18px 0;">

                <h3 style="margin: 0 0 12px 0; font-size: 16px; color: #1d1d1f;">Screen Saver (Burn-in Prevention)</h3>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="screen_saver_enabled" name="screen_saver_enabled">
                        Enable screen saver (turn off backlight when idle)
                    </label>
                    <small>When enabled, the backlight will fade out after inactivity.</small>
                </div>

                <div class="form-group">
                    <label for="screen_saver_timeout_seconds">Idle Timeout (seconds)</label>
                    <input type="number" id="screen_saver_timeout_seconds" name="screen_saver_timeout_seconds" min="0" max="65535" placeholder="300">
                    <small>0 disables automatic sleep. Example: 300 = 5 minutes.</small>
                </div>

                <div class="grid-2col">
                    <section class="section" style="padding: 0; background: transparent; box-shadow: none;">
                        <div class="form-group">
                            <label for="screen_saver_fade_out_ms">Fade Out (ms)</label>
                            <input type="number" id="screen_saver_fade_out_ms" name="screen_saver_fade_out_ms" min="0" max="60000" placeholder="800">
                            <small>0 = instant off</small>
                        </div>
                    </section>
                    <section class="section" style="padding: 0; background: transparent; box-shadow: none;">
                        <div class="form-group">
                            <label for="screen_saver_fade_in_ms">Fade In (ms)</label>
                            <input type="number" id="screen_saver_fade_in_ms" name="screen_saver_fade_in_ms" min="0" max="60000" placeholder="400">
                            <small>0 = instant on</small>
                        </div>
                    </section>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="screen_saver_wake_on_touch" name="screen_saver_wake_on_touch">
                        Wake on touch press
                    </label>
                    <small>Only applies to touch-enabled boards.</small>
                </div>

                <div class="form-group" id="screen-selection-group" style="display:none;">
                    <label for="screen_selection">
                        Current Screen
                    </label>
                    <select id="screen_selection" name="screen_selection">
                        <!-- Options populated by JavaScript from /api/info -->
                    </select>
                    <small>Switch between screens instantly. Selection is not saved (resets on reboot).</small>
                </div>
            </section>

            {{FOOTER}}
        </form>
    </div>

    <script src="/portal.js"></script>
</body>
</html>
